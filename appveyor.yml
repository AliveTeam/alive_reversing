version: 1.0.{build}

image: Visual Studio 2017

platform: 
 - x86
 - x64

configuration:
 - Debug

clone_folder: c:\ar

build_script:
 - mkdir build
 - cd build
 - echo %platform%
 - if %platform%==x64 (cmake .. -DSDL2_DIR=C:\ar\SDL2-2.0.9 -DBUILD_NUMBER=%APPVEYOR_BUILD_NUMBER% -G "Visual Studio 15 2017 Win64")
 - if %platform%==x86 (cmake .. -DSDL2_DIR=C:\ar\SDL2-2.0.9 -DBUILD_NUMBER=%APPVEYOR_BUILD_NUMBER% -G "Visual Studio 15 2017")
 - cmake --build . --config %configuration% -- /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll"
 #- msbuild AR.sln /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll" /m
 - call "C:\Program Files (x86)\cmake\bin\cpack" -G ZIP -C %configuration%

install:
 - git submodule update --init --recursive
 - ps: Start-FileDownload 'https://www.libsdl.org/release/SDL2-devel-2.0.9-VC.zip'
 - 7z x SDL2-devel-2.0.9-VC.zip

after_build:
 - 7z a RELIVE_Symbols_%CONFIGURATION%_%PLATFORM%_%APPVEYOR_BUILD_NUMBER%.zip c:\ar\build\Source\AliveDllAE\%CONFIGURATION%\AliveDllAE.pdb c:\ar\build\Source\AliveDllAO\%CONFIGURATION%\AliveDllAO.pdb c:\ar\build\Source\AliveExe\%CONFIGURATION%\AliveExe.pdb c:\ar\build\Source\AliveExe\%CONFIGURATION%\AliveExeAO.pdb c:\ar\build\Source\AliveExe\%CONFIGURATION%\AliveExeAE.pdb
 - rename ar-*.zip RELIVE_Binaries_Full_%CONFIGURATION%_%PLATFORM%_%APPVEYOR_BUILD_NUMBER%.zip
  - 7z a RELIVE_%CONFIGURATION%_%PLATFORM%.zip c:\ar\build\Source\AliveExe\%CONFIGURATION%\AliveExeAO.exe c:\ar\build\Source\AliveExe\%CONFIGURATION%\AliveExeAE.exe C:\ar\build\Source\AliveDllAE\%CONFIGURATION%\SDL2.dll

artifacts:
 - path: build\RELIVE_Symbols_$(CONFIGURATION)_$(PLATFORM)_$(APPVEYOR_BUILD_NUMBER).zip
   name: RELIVE_Symbols_$(configuration)_$(APPVEYOR_BUILD_NUMBER)

 - path: build\RELIVE_Binaries_Full_$(CONFIGURATION)_$(PLATFORM)_$(APPVEYOR_BUILD_NUMBER).zip
   name: RELIVE_Binaries_Full_$(configuration)_$(APPVEYOR_BUILD_NUMBER)

 - path: build\RELIVE_Binaries_$(CONFIGURATION)_$(PLATFORM)_$(APPVEYOR_BUILD_NUMBER).zip
   name: RELIVE_Binaries_$(configuration)

test: off
